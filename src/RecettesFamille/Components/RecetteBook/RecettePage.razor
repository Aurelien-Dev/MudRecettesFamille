@page "/recette"
@rendermode InteractiveServer
@using RecettesFamille.Data.DtoModel
@using RecettesFamille.Components.RecetteComponents
@using RecettesFamille.Managers

<MudContainer Class="mt-5" MaxWidth="MaxWidth.Large">
    <MudText Typo="Typo.h3" Align="Align.Center" GutterBottom="true">@Recette.Title</MudText>

    @* Details recette *@
    <MudGrid Spacing="8" Class="mt-5">
        <MudItem md="7" xs="12">
            <MudImage Src="https://static.750g.com/images/1200-675/9823eb627203c878f3e36d72f8ce6d1c/tarte-aux-pommes.jpg"
                      Elevation="25" Class="rounded-pill" Fluid="true" Alt="@Recette.Title"></MudImage>
        </MudItem>

        <ViewIngredientsComponent Ingredients="@Recette.Ingredients" />
    </MudGrid>

    <MudButton OnClick="TestConverter">TestConverter</MudButton>

    @* Description recette *@
    <MudGrid Spacing="12" Class="mt-10">
        <MudItem xs="12">
            <MudGrid>
                <MudItem xs="12" Class="d-flex justify-left">
                    @Recette.Description
                </MudItem>
            </MudGrid>
        </MudItem>
        @* <ViewDescriptionsComponent Descriptions="@Recette.Descriptions" /> *@
    </MudGrid>
</MudContainer>


@code {
    [Inject] GptRecipeConverterManager gptRecipeConverterManager { get; set; } = null!;

    RecetteDto Recette { get; set; } = null!;

    protected override void OnInitialized()
    {
        Recette = new RecetteDto
            {
                Title = "Tarte Tatin",
                Ingredients = new List<IngredientDto>
            {
                new("Gateau", IngredientType.Divider),
                new("Pommes", IngredientType.Ingredient) { Quantity = "6" },
                new("Sucre", IngredientType.Ingredient) { Quantity = "150g" },
                new("Beurre", IngredientType.Ingredient) { Quantity = "100g" },
                new("Pâte feuilletée", IngredientType.Ingredient) { Quantity = "1 rouleau" }
            }
        };
    }

    private async Task TestConverter()
    {
        var dd = await gptRecipeConverterManager.GenerateDescription();
        Console.WriteLine("TestConverter");

        Recette = dd.Item1;
    }

}