@using RecettesFamille.Data
@using RecettesFamille.Data.EntityModel.RecipeSubEntity
@inherits BaseBlockDefinition<BlockInstructionEntity>

@if (EditMode)
{
    <MudStack Row="true" Spacing="0">

        <MudTextField @bind-Value="@Block.Instruction" T="string" Variant="Variant.Outlined" FullWidth="true" AutoGrow OnBlur="LostFocus"
                      OnAdornmentClick="AdornmentClick" AdornmentIcon="@Icons.Material.Outlined.Delete" Adornment="Adornment.End" AdornmentColor="Color.Error" />



    </MudStack>
}
else
{
    <MudText Typo="Typo.body2" Style="white-space: pre-line;">
        @Block.Instruction
    </MudText>
}

@code {
    public string OriginalInstruction { get; set; } = string.Empty;

    protected override void OnParametersSet()
    {
        OriginalInstruction = Block.Instruction;
    }

    private void AdornmentClick() => OnBlockDeleted?.Invoke(Block);
    public void LostFocus()
    {
        if (Block.Instruction == OriginalInstruction)
            return;

        OnBlockUpdated?.Invoke(Block);
    }
}